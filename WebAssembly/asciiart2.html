<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>asciiart2</title>
<style>
pre {
	background: #f0f0f0;
}
</style>
</head>

<body>
<a href="https://wasdk.github.io/WasmFiddle/">WasmFiddle</a>
<pre id="output"></pre>
<pre>
// asciiart WebAssembly

int vram[2048];
int p;

void putchar(int c) {
	vram[p++] = c;
}

void mandel(int i, float a, float b, float ca, float cb) {
	if (i >= 16) {
		putchar(' ');
	} else {
		float an = a * a - b * b + ca;
		float bn = 2 * a * b + cb;
		if ((an * an + bn * bn) > 4) {
			int c = (i < 10) ? i + 48 : i + 55;
			putchar(c);
		} else {
			mandel(i + 1, an, bn, ca, cb);
		}
	}
}

int* asciiart() {
	p = 0;
	for (int y = -12; y <= 12; y++) {
		for (int x = -39; x <= 39; x++) {
			float ca = x * 0.0458f;
			float cb = y * 0.08333f;
			mandel(0, ca, cb, ca, cb);
		}
		putchar('\n');
	}
	putchar(0);
	return vram;
}
</pre>
<script>

"use strict";

var wasmCode = new Uint8Array([0,97,115,109,1,0,0,0,1,145,128,128,128,0,3,96,1,127,0,96,5,127,125,125,125,125,0,96,0,1,127,3,132,128,128,128,0,3,0,1,2,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,168,128,128,128,0,4,6,109,101,109,111,114,121,2,0,7,112,117,116,99,104,97,114,0,0,6,109,97,110,100,101,108,0,1,8,97,115,99,105,105,97,114,116,0,2,10,230,136,128,128,0,3,162,128,128,128,0,1,1,127,65,0,65,0,40,2,144,64,34,1,65,1,106,54,2,144,64,32,1,65,2,116,65,16,106,32,0,54,2,0,11,152,129,128,128,0,2,1,125,2,127,65,32,33,7,2,64,32,0,65,15,74,13,0,2,64,3,64,32,2,32,2,148,33,5,32,1,32,1,146,32,2,148,32,4,146,34,2,32,2,148,32,1,32,1,148,32,5,147,32,3,146,34,5,32,5,148,146,34,1,67,0,0,128,64,95,32,1,32,1,92,114,69,13,1,32,0,65,15,72,33,6,32,5,33,1,32,0,65,1,106,33,0,32,6,13,0,12,2,11,11,65,48,65,55,32,0,65,10,72,27,32,0,106,33,7,11,65,0,65,0,40,2,144,64,34,0,65,1,106,54,2,144,64,32,0,65,2,116,65,16,106,32,7,54,2,0,11,156,135,128,128,0,3,3,127,8,125,4,127,65,0,33,1,65,0,65,0,54,2,144,64,65,116,33,2,65,16,33,0,3,64,32,2,178,67,235,168,170,61,148,34,3,32,3,148,33,4,65,89,33,12,32,0,33,11,3,64,65,0,33,13,2,64,2,64,32,3,32,3,32,12,178,67,200,152,59,61,148,34,5,32,5,146,148,146,34,7,32,7,148,34,9,32,5,32,5,32,5,148,32,4,147,146,34,6,32,6,148,34,8,146,34,10,67,0,0,128,64,95,32,10,32,10,92,114,69,13,0,65,1,33,13,32,3,32,7,32,6,32,6,146,148,146,34,10,32,10,148,34,7,32,5,32,8,32,9,147,146,34,6,32,6,148,34,9,146,67,0,0,128,64,94,13,0,65,2,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,8,32,5,32,9,32,7,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,3,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,9,32,5,32,7,32,8,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,4,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,8,32,5,32,7,32,9,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,5,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,9,32,5,32,7,32,8,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,6,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,8,32,5,32,7,32,9,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,7,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,9,32,5,32,7,32,8,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,8,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,8,32,5,32,7,32,9,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,9,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,9,32,5,32,7,32,8,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,10,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,8,32,5,32,7,32,9,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,11,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,9,32,5,32,7,32,8,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,12,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,8,32,5,32,7,32,9,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,13,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,9,32,5,32,7,32,8,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,14,33,13,32,3,32,10,32,6,32,6,146,148,146,34,10,32,10,148,34,8,32,5,32,7,32,9,147,146,34,6,32,6,148,34,7,146,67,0,0,128,64,94,13,0,65,32,33,14,65,15,33,13,32,3,32,10,32,6,32,6,146,148,146,34,6,32,6,148,32,5,32,7,32,8,147,146,34,5,32,5,148,146,67,0,0,128,64,94,69,13,1,11,65,48,65,55,32,13,65,10,73,27,32,13,106,33,14,11,32,11,32,14,54,2,0,32,11,65,4,106,33,11,32,12,65,1,106,34,12,65,40,71,13,0,11,32,1,65,2,116,65,204,2,106,65,10,54,2,0,32,0,65,192,2,106,33,0,32,1,65,208,0,106,33,1,32,2,65,1,106,34,2,65,13,71,13,0,11,65,0,65,209,15,54,2,144,64,65,0,65,0,54,2,208,62,65,16,11,11,140,128,128,128,0,1,0,65,144,192,0,11,4,0,0,0,0]);

onload = function() {
	let wm = new WebAssembly.Module(wasmCode);
	let wi = new WebAssembly.Instance(wm, []);
	let memory = wi.exports.memory;
	let asciiart = wi.exports.asciiart;

	let vram = asciiart();
	let buf = new Uint32Array(memory.buffer, vram);
	let txt = "";
	for (let i = 0; ; i++) {
		let c = buf[i];
		if (c === 0) break;
		txt += String.fromCodePoint(c);
	}
//	log(txt);
	output.textContent = txt;
};

</script>
</body>
</html>
